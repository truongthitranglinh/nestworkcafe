<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NestWork Admin | H·ªá th·ªëng qu·∫£n l√Ω</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="admin-style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

    <aside class="sidebar">
        <div class="sidebar-header">
            <div class="logo-box">
              <img src="img/logo.jpg" alt="NestWork Logo" class="logo-img">
            </div>
            <div>
                <h1 class="brand-name">NestWork</h1>
                <p class="role-text">Qu·∫£n tr·ªã vi√™n</p>
            </div>
        </div>
        <nav>
  <div class="nav-item active" id="btn-dashboard" data-page="dashboard">
    <i class="fas fa-th-large"></i>
    <span>Dashboard</span>
  </div>

  <div class="nav-item" id="btn-orders" data-page="orders">
    <i class="fas fa-shopping-cart"></i>
    <span>Qu·∫£n l√Ω ƒê∆°n h√†ng</span>
  </div>

  <div class="nav-item" id="btn-warehouse" data-page="warehouse">
    <i class="fas fa-box"></i>
    <span>Qu·∫£n l√Ω Kho</span>
  </div>

  <div class="nav-item" id="btn-staff" data-page="staff">
  <i class="fas fa-user-friends"></i>
  <span>Qu·∫£n l√Ω Nh√¢n vi√™n</span>
</div>


  <div class="nav-item" id="btn-booking" data-page="booking">
    <i class="fas fa-calendar-alt"></i>
    <span>Qu·∫£n l√Ω ƒê·∫∑t b√†n</span>
  </div>

  <div class="nav-item" data-page="attendance">
    <i class="fas fa-user-clock"></i>
    <span>Ch·∫•m c√¥ng</span>
  </div>

  <div class="nav-divider"></div>

  <div class="nav-item">
    <i class="fas fa-cog"></i>
    <span>C√†i ƒë·∫∑t</span>
  </div>

  <div class="nav-item logout" id="adminLogoutBtn">
    <i class="fas fa-sign-out-alt"></i>
    <span>ƒêƒÉng xu·∫•t</span>
  </div>
</nav>

    </aside>

    <main class="main-content">
        <div id="page-dashboard" class="page-section active">
            <header>
                <div class="header-info">
                    <h2>Dashboard <span class="highlight">T·ªïng Quan</span></h2>
                    <p class="sub-header">Ch√†o m·ª´ng tr·ªü l·∫°i! ƒê√¢y l√† t·ªïng quan h√¥m nay.</p>
                </div>
            </header>

            <div class="quick-stats-grid">
                <div class="stat-item blue anim-on-scroll">
                    <div class="stat-icon"><i class="fas fa-shopping-cart"></i></div>
                    <div class="stat-info"><span>ƒê∆°n h√†ng</span><strong>24</strong></div>
                </div>
                <div class="stat-item green anim-on-scroll">
                    <div class="stat-icon"><i class="fas fa-dollar-sign"></i></div>
                    <div class="stat-info"><span>Doanh thu</span><strong>8.4trƒë</strong></div>
                </div>
                <div class="stat-item orange anim-on-scroll">
                    <div class="stat-icon"><i class="fas fa-exclamation-circle"></i></div>
                    <div class="stat-info"><span>Ch·ªù x·ª≠ l√Ω</span><strong>05</strong></div>
                </div>
                <div class="stat-item purple anim-on-scroll">
                    <div class="stat-icon"><i class="fas fa-calendar-check"></i></div>
                    <div class="stat-info"><span>ƒê·∫∑t b√†n</span><strong>12</strong></div>
                </div>
                <div class="stat-item red anim-on-scroll">
                    <div class="stat-icon"><i class="fas fa-archive"></i></div>
                    <div class="stat-info"><span>S·∫Øp h·∫øt</span><strong>01</strong></div>
                </div>
                <div class="stat-item indigo anim-on-scroll">
                    <div class="stat-icon"><i class="fas fa-users"></i></div>
                    <div class="stat-info"><span>Nh√¢n vi√™n</span><strong>03</strong></div>
                </div>
            </div>

            <div class="dashboard-layout">
                <div class="col-left">
                    <div class="card anim-on-scroll">
                        <div class="card-head"><p>Doanh thu</p><button class="btn-report">View Report</button></div>
                        <h3>‚âà 245 ‚Äì 265 tri·ªáu VND / th√°ng <span class="up">‚Üë 2.14%</span></h3>
                        <p class="date-text">T·ª´ th√°ng 1 - th√°ng 10, nƒÉm 2026</p>
                        <div style="height: 250px; margin-top:20px;"><canvas id="revenueChart"></canvas></div>
                    </div>
                    <div class="two-col">
                        <div class="card anim-on-scroll">
                            <h4 class="card-title">ƒê√°nh gi√°</h4>
                            <p class="card-subtitle">C·∫£m nh·∫≠n c·ªßa kh√°ch h√†ng</p>

                            <div class="rating-list">
                                <div class="rating-item">
                                <div class="rating-top">
                                    <span>Ti·ªán √≠ch</span>
                                    <b>85%</b>
                                </div>
                                <div class="rating-bar">
                                    <span class="rating-fill fill-1" style="width:85%"></span>
                                </div>
                                </div>

                                <div class="rating-item">
                                <div class="rating-top">
                                    <span>Ch·∫•t l∆∞·ª£ng</span>
                                    <b>85%</b>
                                </div>
                                <div class="rating-bar">
                                    <span class="rating-fill fill-2" style="width:85%"></span>
                                </div>
                                </div>

                                <div class="rating-item">
                                <div class="rating-top">
                                    <span>V·ªá sinh</span>
                                    <b>92%</b>
                                </div>
                                <div class="rating-bar">
                                    <span class="rating-fill fill-3" style="width:92%"></span>
                                </div>
                                </div>
                            </div>
                        </div>

                        <div class="card anim-on-scroll">
                            <p class="card-label">M√≥n ƒÉn ƒë∆∞·ª£c y√™u c·∫ßu nhi·ªÅu nh·∫•t</p>
                            <div class="request-list">
                                <div class="req-item"><span>Cappuccino</span><b>25.000 VND</b></div>
                                <div class="req-item"><span>Tr√† s·ªØa vi·ªát qu·∫•t</span><b>25.000 VND-35.000 VND </b></div>
                                <div class="req-item"><span>Soda b·∫°c h√† </span><b>20.000 VND</b></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-right">
                    <div class="card anim-on-scroll">
                        <div class="card-head"><p>S·ªë l∆∞·ª£ng ƒë∆°n h√†ng trong ng√†y</p><button class="btn-report">View Report</button></div>
                        <div style="height: 180px;"><canvas id="orderTimeChart"></canvas></div>
                    </div>
                    
                    <div class="card order-card anim-on-scroll">
                        <div class="card-head">
                            <div>
                            <p class="card-kicker">Order</p>
                            <h3 class="order-num">2.568</h3>
                            <p class="order-delta"><span class="down">‚Üì 2.14%</span> vs last week</p>
                            <p class="date-text">Sales from 12‚Äì18 Dec, 2021</p>
                            </div>
                            <button class="btn-report">View Report</button>
                        </div>

                        <div class="chart-box chart-line-2">
                            <canvas id="orderCompareChart"></canvas>
                        </div>

                        <div class="chart-legend">
                            <span class="lg"><i class="dot d1"></i> Last 6 days</span>
                            <span class="lg"><i class="dot d2"></i> Last Week</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="page-orders" class="page-section">
            
  <header class="orders-header">
    <div>
      <h2 class="orders-title">Qu·∫£n l√Ω ƒê∆°n h√†ng</h2>
      <p class="orders-sub">Xem v√† x·ª≠ l√Ω t·∫•t c·∫£ ƒë∆°n h√†ng t·ª´ QR code</p>
    </div>
  </header>

  <!-- Stats -->
  <div class="order-kpi-grid">
    <div class="order-kpi kpi-wait">
      <div>
        <p>Ch·ªù x·ª≠ l√Ω</p>
        <b id="kpi-wait">1</b>
      </div>
      <span class="kpi-ico"><i class="fa-regular fa-clock"></i></span>
    </div>

    <div class="order-kpi kpi-prep">
      <div>
        <p>ƒêang chu·∫©n b·ªã</p>
        <b id="kpi-prep">1</b>
      </div>
      <span class="kpi-ico"><i class="fa-solid fa-cube"></i></span>
    </div>

    <div class="order-kpi kpi-ready">
      <div>
        <p>S·∫µn s√†ng</p>
        <b id="kpi-ready">1</b>
      </div>
      <span class="kpi-ico"><i class="fa-regular fa-circle-check"></i></span>
    </div>

    <div class="order-kpi kpi-done">
      <div>
        <p>Ho√†n th√†nh</p>
        <b id="kpi-done">1</b>
      </div>
      <span class="kpi-ico"><i class="fa-regular fa-circle-check"></i></span>
    </div>
  </div>

  <!-- Controls -->
  <div class="admin-orders-ui">
      <!-- FILTERS gi·ªëng ·∫£nh -->
      <div class="order-controls-2">
        <div class="field">
          <label>Ng√†y</label>
          <select id="filterDateA">
            <option value="today">H√¥m nay</option>
            <option value="week">Tu·∫ßn n√†y</option>
            <option value="month">Th√°ng n√†y</option>
            <option value="year">NƒÉm nay</option>
          </select>
        </div>

        <div class="field">
          <label>Khung gi·ªù</label>
          <select id="filterTimeA">
            <option value="all">T·∫•t c·∫£</option>
            <option value="morning">S√°ng</option>
            <option value="noon">Tr∆∞a</option>
            <option value="afternoon">Chi·ªÅu</option>
            <option value="evening">T·ªëi</option>
          </select>
        </div>

        <div class="field">
          <label>Khu v·ª±c</label>
          <select id="filterAreaA">
            <option value="all">T·∫•t c·∫£ khu v·ª±c</option>
            <option value="B√†n l√†m vi·ªác c√° nh√¢n">B√†n l√†m vi·ªác c√° nh√¢n</option>
            <option value="Ph√≤ng m√°y">Ph√≤ng m√°y</option>
            <option value="Ph√≤ng nh√≥m nh·ªè (4-6 ng∆∞·ªùi)">Ph√≤ng nh√≥m nh·ªè (4-6 ng∆∞·ªùi)</option>
            <option value="Ph√≤ng nh√≥m l·ªõn (8-12 ng∆∞·ªùi)">Ph√≤ng nh√≥m l·ªõn (8-12 ng∆∞·ªùi)</option>
          </select>
        </div>
      </div>
      

  <!-- LIST -->
  <div class="ordersListWrap" id="ordersList"></div>
</div>


        <!-- Content -->
        <div class="orders-layout">


            <!-- RIGHT: details -->
                    <div class="order-detail">
                    <div class="detail-empty" id="detailEmpty">
                        <div class="detail-icon"><i class="fa-solid fa-cube"></i></div>
                        <p>Ch·ªçn ƒë∆°n h√†ng ƒë·ªÉ xem chi ti·∫øt</p>
                    </div>

                    <div class="detail-box" id="detailBox" style="display:none;">
                        <h3 id="detailTitle">ORD-001</h3>
                        <p class="muted">Chi ti·∫øt ƒë∆°n s·∫Ω hi·ªÉn th·ªã ·ªü ƒë√¢y‚Ä¶</p>
                    </div>
                    </div>
                </div>
                </div>

        <div id="page-warehouse" class="page-section">  

          <!-- HEADER -->
          <header class="orders-header">
              <div>
              <h2 class="orders-title">Qu·∫£n l√Ω Kho</h2>
              <p class="orders-sub">Qu·∫£n l√Ω nguy√™n li·ªáu, v·∫≠t t∆∞ v√† theo d√µi t·ªìn kho</p>
              </div>

              <button class="btn-report">
              <i class="fas fa-plus"></i> Th√™m s·∫£n ph·∫©m
              </button>
          </header>

          <!-- C·∫¢NH B√ÅO -->
          <div class="card" style="background:#fff1f1;border:1px solid #ffdcdc">
              <p style="font-weight:700;color:#b42318">
              ‚ö†Ô∏è C·∫£nh b√°o: 4 s·∫£n ph·∫©m s·∫Øp h·∫øt
              </p>

              <div style="display:grid;grid-template-columns:repeat(4,1fr);gap:12px;margin-top:12px">
              <div class="card">
                  <b>C√† ph√™ h·∫°t Arabica</b>
                  <p class="text-sm">C√≤n: <span style="color:red">2 kg</span></p>
              </div>
              <div class="card">
                  <b>S·ªØa t∆∞∆°i nguy√™n ch·∫•t</b>
                  <p class="text-sm">C√≤n: <span style="color:red">5 l√≠t</span></p>
              </div>
              <div class="card">
                  <b>Ly gi·∫•y size M</b>
                  <p class="text-sm">C√≤n: <span style="color:red">150 c√°i</span></p>
              </div>
              <div class="card">
                  <b>Siro vani</b>
                  <p class="text-sm">C√≤n: <span style="color:red">3 chai</span></p>
              </div>
              </div>
          </div>

          <!-- KPI -->
          <div class="order-kpi-grid">
              <div class="order-kpi kpi-ready">
              <p>T·ªïng s·∫£n ph·∫©m</p>
              <b>7</b>
              </div>
              <div class="order-kpi kpi-wait">
              <p>S·∫Øp h·∫øt h√†ng</p>
              <b>4</b>
              </div>
              <div class="order-kpi kpi-prep">
              <p>Nh√† cung c·∫•p</p>
              <b>5</b>
              </div>
              <div class="order-kpi kpi-done">
              <p>Gi√° tr·ªã kho</p>
              <b>6.6tr</b>
              </div>
          </div>

          <!-- SEARCH -->
          <div class="order-controls-2">
              <input class="status-select-2" placeholder="T√¨m ki·∫øm s·∫£n ph·∫©m...">
              <select class="status-select-2">
              <option>T·∫•t c·∫£ danh m·ª•c</option>
              <option>C√† ph√™</option>
              <option>S·ªØa</option>
              <option>Bao b√¨</option>
              <option>Nguy√™n li·ªáu</option>
              </select>
          </div>

          <!-- TABLE -->
          <div class="card">
              <table style="width:100%;border-collapse:collapse">
              <thead>
                  <tr style="text-align:left">
                  <th>S·∫£n ph·∫©m</th>
                  <th>Danh m·ª•c</th>
                  <th>T·ªìn kho</th>
                  <th>ƒê∆°n gi√°</th>
                  <th>Nh√† cung c·∫•p</th>
                  <th>C·∫≠p nh·∫≠t</th>
                  <th></th>
                  </tr>
              </thead>
              <tbody>
                  <tr>
                  <td>‚òï C√† ph√™ h·∫°t Arabica</td>
                  <td>C√† ph√™</td>
                  <td style="color:red">2 kg</td>
                  <td>350.000ƒë</td>
                  <td>Cty CP Cafe Vi·ªát</td>
                  <td>10/1/2026</td>
                  <td>
                      ‚úèÔ∏è üóë
                  </td>
                  </tr>

                  <tr>
                  <td>ü•õ S·ªØa t∆∞∆°i nguy√™n ch·∫•t</td>
                  <td>S·ªØa</td>
                  <td style="color:red">5 l√≠t</td>
                  <td>35.000ƒë</td>
                  <td>Vinamilk</td>
                  <td>12/1/2026</td>
                  <td>‚úèÔ∏è üóë</td>
                  </tr>

                  <tr>
                  <td>üì¶ Ly gi·∫•y size M</td>
                  <td>Bao b√¨</td>
                  <td>150 c√°i</td>
                  <td>800ƒë</td>
                  <td>Cty Bao b√¨ Xanh</td>
                  <td>8/1/2026</td>
                  <td>‚úèÔ∏è üóë</td>
                  </tr>
              </tbody>
              </table>
          </div>
        </div>
        <div id="page-staff" class="page-section">

          <!-- HEADER -->
          <header class="orders-header staff-header">
            <div>
              <h2 class="orders-title">Qu·∫£n l√Ω Nh√¢n vi√™n</h2>
              <p class="orders-sub">Qu·∫£n l√Ω th√¥ng tin v√† l∆∞∆°ng nh√¢n vi√™n</p>
            </div>

            <button class="btn-report" id="btnAddStaff">
              <i class="fas fa-plus"></i> Th√™m nh√¢n vi√™n
            </button>
          </header>

          <!-- KPI -->
          <div class="staff-kpi-grid">
            <div class="staff-kpi">
              <p>T·ªïng nh√¢n vi√™n</p>
              <b id="kpiStaffTotal">0</b>
              <span class="kpi-ico"><i class="fa-solid fa-users"></i></span>
            </div>
            <div class="staff-kpi kpi-green">
              <p>ƒêang l√†m vi·ªác</p>
              <b id="kpiStaffWorking">0</b>
              <span class="kpi-ico"><i class="fa-solid fa-user-check"></i></span>
            </div>
            <div class="staff-kpi kpi-red">
              <p>ƒê√£ ngh·ªâ</p>
              <b id="kpiStaffLeft">0</b>
              <span class="kpi-ico"><i class="fa-solid fa-user-xmark"></i></span>
            </div>
            <div class="staff-kpi kpi-blue">
              <p>T·ªïng l∆∞∆°ng / th√°ng</p>
              <b id="kpiStaffSalary">0ƒë</b>
              <span class="kpi-ico"><i class="fa-solid fa-dollar-sign"></i></span>
            </div>
          </div>

          <!-- FILTER -->
          <div class="staff-controls">
            <div class="search-box-2 staff-search">
              <i class="fa-solid fa-magnifying-glass"></i>
              <input id="staffSearch" type="text" placeholder="T√¨m theo t√™n, email ho·∫∑c s·ªë ƒëi·ªán tho·∫°i..." />
            </div>

            <select id="staffRoleFilter" class="status-select-2">
              <option value="all">T·∫•t c·∫£ v·ªã tr√≠</option>
              <option value="Qu·∫£n l√Ω">Qu·∫£n l√Ω</option>
              <option value="Pha ch·∫ø">Pha ch·∫ø</option>
              <option value="Thu ng√¢n">Thu ng√¢n</option>
            </select>

            <select id="staffStatusFilter" class="status-select-2">
              <option value="all">T·∫•t c·∫£ tr·∫°ng th√°i</option>
              <option value="ƒêang l√†m">ƒêang l√†m</option>
              <option value="ƒê√£ ngh·ªâ">ƒê√£ ngh·ªâ</option>
            </select>
          </div>

          <!-- LAYOUT -->
          <div class="staff-layout">

            <!-- LEFT LIST -->
            <div class="staff-list" id="staffList"></div>

            <!-- RIGHT DETAIL -->
            <div class="staff-detail">
              <div class="detail-empty" id="staffDetailEmpty">
                <div class="detail-icon"><i class="fa-solid fa-user"></i></div>
                <p>Ch·ªçn nh√¢n vi√™n ƒë·ªÉ xem chi ti·∫øt</p>
              </div>

              <div class="detail-box" id="staffDetailBox" style="display:none;">
                <h3 id="staffDetailName">‚Äî</h3>
                <p class="muted" id="staffDetailMeta">‚Äî</p>

                <div class="detail-grid">
                  <div class="drow"><span>Email</span><b id="dEmail">‚Äî</b></div>
                  <div class="drow"><span>SƒêT</span><b id="dPhone">‚Äî</b></div>
                  <div class="drow"><span>V·ªã tr√≠</span><b id="dRole">‚Äî</b></div>
                  <div class="drow"><span>Tr·∫°ng th√°i</span><b id="dStatus">‚Äî</b></div>
                  <div class="drow"><span>V√†o l√†m</span><b id="dStart">‚Äî</b></div>
                  <div class="drow"><span>L∆∞∆°ng / th√°ng</span><b id="dSalary">‚Äî</b></div>
                </div>
              </div>
            </div>

          </div>
        </div>

        <div id="page-booking" class="page-section">
          <header class="orders-header">
            <div>
              <h2 class="orders-title">Qu·∫£n l√Ω ƒê·∫∑t b√†n</h2>
              <p class="orders-sub">Xem v√† x·ª≠ l√Ω c√°c y√™u c·∫ßu ƒë·∫∑t b√†n t·ª´ kh√°ch</p>
            </div>
          </header>

          <!-- FILTERS -->
          <div class="booking-filters">
            <div class="field">
              <label>Ng√†y</label>
              <select id="bkFilterDate">
                <option value="all">T·∫•t c·∫£</option>
                <option value="today">H√¥m nay</option>
                <option value="week">Tu·∫ßn n√†y</option>
                <option value="month">Th√°ng n√†y</option>
                <option value="year">NƒÉm nay</option>
              </select>
            </div>

            <div class="field">
              <label>Khung gi·ªù</label>
              <select id="bkFilterTime">
                <option value="all">T·∫•t c·∫£</option>
                <option value="morning">S√°ng</option>
                <option value="noon">Chi·ªÅu</option>
                <option value="evening">T·ªëi</option>
              </select>
            </div>

            <div class="field">
              <label>Khu v·ª±c</label>
              <select id="bkFilterArea">
                <option value="all">T·∫•t c·∫£ khu v·ª±c</option>
                <option value="B√†n h·ªçc ƒë∆°n">B√†n h·ªçc ƒë∆°n</option>
                <option value="Ph√≤ng m√°y">Ph√≤ng m√°y</option>
                <option value="Ph√≤ng h·ªçc nh·ªè">Ph√≤ng h·ªçc nh·ªè</option>
                <option value="Ph√≤ng h·ªçp l·ªõn">Ph√≤ng h·ªçp l·ªõn</option>
              </select>
            </div>
          </div>

          <!-- LIST -->
          <div class="booking-list" id="bookingList"></div>
        </div>

          <!-- ================== PAGE: ATTENDANCE (ADMIN) ================== -->
          <div id="page-attendance" class="page-section">
            <header class="att-header">
              <div>
                <h2 class="att-title">Qu·∫£n l√Ω Ch·∫•m c√¥ng</h2>
                <p class="att-sub">Theo d√µi v√† qu·∫£n l√Ω th·ªùi gian l√†m vi·ªác c·ªßa nh√¢n vi√™n</p>
              </div>
            </header>

            <!-- Toolbar -->
            <div class="att-toolbar">
              <div class="att-tools-left">
                <div class="att-search">
                  <i class="fa-solid fa-magnifying-glass"></i>
                  <input id="attSearchInput" type="text" placeholder="T√¨m ki·∫øm nh√¢n vi√™n..." />
                </div>

                <div class="att-date">
                  <input id="attDateInput" type="date" />
                  <i class="fa-regular fa-calendar"></i>
                </div>

                <div class="att-select">
                  <select id="attStatusFilter">
                    <option value="all">T·∫•t c·∫£</option>
                    <option value="ƒê√∫ng gi·ªù">ƒê√∫ng gi·ªù</option>
                    <option value="Mu·ªôn">Mu·ªôn</option>
                    <option value="V·∫Øng m·∫∑t">V·∫Øng m·∫∑t</option>
                    <option value="V·ªÅ s·ªõm">V·ªÅ s·ªõm</option>
                  </select>
                  <i class="fa-solid fa-angle-down"></i>
                </div>
              </div>

              <div class="att-tools-right">
                <button class="att-btn ghost" id="btnExportAtt">
                  <i class="fa-solid fa-download"></i>
                  Xu·∫•t file
                </button>
                <button class="att-btn primary" id="btnAddAtt">
                  <i class="fa-solid fa-plus"></i>
                  Th√™m b·∫£n ghi
                </button>
              </div>
            </div>

            <!-- KPI -->
            <div class="att-kpi-grid">
              <div class="att-kpi">
                <div class="kpi-text">
                  <p>T·ªïng NV h√¥m nay</p>
                  <b id="kpiTotal">0</b>
                </div>
                <div class="kpi-ico kpi-yellow"><i class="fa-solid fa-user-group"></i></div>
              </div>

              <div class="att-kpi">
                <div class="kpi-text">
                  <p>ƒê√∫ng gi·ªù</p>
                  <b id="kpiOnTime">0</b>
                </div>
                <div class="kpi-ico kpi-green"><i class="fa-solid fa-circle-check"></i></div>
              </div>

              <div class="att-kpi">
                <div class="kpi-text">
                  <p>ƒêi mu·ªôn</p>
                  <b id="kpiLate">0</b>
                </div>
                <div class="kpi-ico kpi-orange"><i class="fa-solid fa-circle-exclamation"></i></div>
              </div>

              <div class="att-kpi">
                <div class="kpi-text">
                  <p>V·∫Øng m·∫∑t</p>
                  <b id="kpiAbsent">0</b>
                </div>
                <div class="kpi-ico kpi-red"><i class="fa-solid fa-circle-xmark"></i></div>
              </div>
            </div>

            <!-- Table -->
            <div class="att-table-card">
              <table class="att-table">
                <thead>
                  <tr>
                    <th>M√£ NV</th>
                    <th>T√™n nh√¢n vi√™n</th>
                    <th>B·ªô ph·∫≠n</th>
                    <th>Ng√†y</th>
                    <th>Gi·ªù v√†o</th>
                    <th>Gi·ªù ra</th>
                    <th>T·ªïng gi·ªù</th>
                    <th>Tr·∫°ng th√°i</th>
                    <th>Ghi ch√∫</th>
                    <th>Thao t√°c</th>
                  </tr>
                </thead>

                <tbody id="attTbody">
                  <!-- render b·∫±ng JS -->
                </tbody>
              </table>
            </div>
          </div>


      

    </main>

    <script>
        function switchPage(pageId) {
    // ·∫®n t·∫•t c·∫£ page
    document.querySelectorAll('.page-section').forEach(p => p.classList.remove('active'));
    // B·ªè active t·∫•t c·∫£ menu
    document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));

    // Hi·ªán page ƒë∆∞·ª£c ch·ªçn
    document.getElementById('page-' + pageId).classList.add('active');

    // Active ƒë√∫ng n√∫t menu t∆∞∆°ng ·ª©ng
    const btn = document.querySelector(`.nav-item[data-page="${pageId}"]`);
    if (btn) btn.classList.add('active');
}


        // --- C√ÅC BI·ªÇU ƒê·ªí DASHBOARD ---
        new Chart(document.getElementById('revenueChart'), {
            type: 'bar',
            data: {
                labels: ['01','02','03','04','05','06','07','08','09','10'],
                datasets: [{ data: [15,12,18,11,22,16,19,14,20,17], backgroundColor: '#8c8856', borderRadius: 5 }]
            },
            options: { maintainAspectRatio: false, plugins: { legend: { display: false } } }
        });

        new Chart(document.getElementById('orderTimeChart'), {
            type: 'doughnut',
            data: {
                labels: ['Afternoon', 'Evening', 'Morning'],
                datasets: [{ data: [40, 32, 28], backgroundColor: ['#8c8856', '#3e2723', '#d7ccc8'] }]
            },
            options: { maintainAspectRatio: false, cutout: '70%', plugins: { legend: { position: 'bottom' } } }
        });

        new Chart(document.getElementById('orderLineChart'), {
            type: 'line',
            data: {
                labels: ['01','02','03','04','05','06','07','08'],
                datasets: [{ data: [10, 15, 12, 18, 11, 14, 10, 22], borderColor: '#3e2723', backgroundColor: 'rgba(62, 39, 35, 0.05)', fill: true, tension: 0.4, pointRadius: 0 }]
            },
            options: { 
                maintainAspectRatio: false, 
                plugins: { legend: { display: false } },
                scales: { x: { display: false }, y: { display: false } }
            }
        });

        new Chart(document.getElementById('orderCompareChart'), {
            type: 'line',
            data: {
                labels: ['01','02','03','04','05','06'],
                datasets: [
                {
                    label: 'Last 6 days',
                    data: [10, 8, 14, 13, 9, 20],
                    borderColor: '#3e2723',
                    borderWidth: 3,
                    tension: 0.45,
                    pointRadius: 0
                },
                {
                    label: 'Last Week',
                    data: [16, 12, 10, 15, 11, 14],
                    borderColor: '#d7ccc8',
                    borderWidth: 3,
                    tension: 0.45,
                    pointRadius: 0
                }
                ]
            },
            options: {
                maintainAspectRatio: false,
                plugins: { legend: { display: false } },
                scales: {
                x: { grid: { display: false }, ticks: { color: '#94a3b8' } },
                y: { display: false, grid: { display: false } }
                }
            }
            });


        function selectOrder(orderId){
                document.querySelectorAll('.order-card-2').forEach(el => el.classList.remove('selected'));
                const card = [...document.querySelectorAll('.order-card-2')].find(x => x.querySelector('.order-id b')?.textContent === orderId);
                if(card) card.classList.add('selected');

                document.getElementById('detailEmpty').style.display = 'none';
                document.getElementById('detailBox').style.display = 'block';
                document.getElementById('detailTitle').textContent = orderId;
            }
        document.querySelectorAll('.nav-item[data-page]').forEach(item => {
        item.addEventListener('click', () => switchPage(item.dataset.page));
        });

    </script>

  <script>
  // ===== ORDERS (ADMIN) =====
  function getOrders(){
    try { return JSON.parse(localStorage.getItem("orders") || "[]"); }
    catch(e){ return []; }
  }
  function saveOrders(arr){
    localStorage.setItem("orders", JSON.stringify(arr));
  }

  // map status -> badge class (b·∫°n c√≥ th·ªÉ ch·ªânh theo CSS c·ªßa b·∫°n)
  function badgeClass(status){
    if(status === "Ch·ªù duy·ªát") return "badge-wait";
    if(status === "ƒê√£ duy·ªát")  return "badge-ready";
    if(status === "Kh√¥ng t·ªõi") return "badge-prep";   // t·∫°m d√πng m√†u s·∫µn
    if(status === "ƒê√£ h·ªßy")    return "badge-done";   // t·∫°m d√πng m√†u s·∫µn
    return "badge-wait";
  }

  function renderAdminOrders(){
    const box = document.getElementById("ordersList");
    if(!box) return;

    const orders = getOrders();

    // c·∫≠p nh·∫≠t KPI ƒë∆°n gi·∫£n theo status
    const wait = orders.filter(o => (o.status || "Ch·ªù duy·ªát") === "Ch·ªù duy·ªát").length;
    const prep = orders.filter(o => (o.status || "") === "Kh√¥ng t·ªõi").length;
    const ready = orders.filter(o => (o.status || "") === "ƒê√£ duy·ªát").length;
    const done = orders.filter(o => (o.status || "") === "ƒê√£ h·ªßy").length;

    const elWait  = document.getElementById("kpi-wait");
    const elPrep  = document.getElementById("kpi-prep");
    const elReady = document.getElementById("kpi-ready");
    const elDone  = document.getElementById("kpi-done");
    if(elWait)  elWait.textContent  = wait;
    if(elPrep)  elPrep.textContent  = prep;
    if(elReady) elReady.textContent = ready;
    if(elDone)  elDone.textContent  = done;

    if(orders.length === 0){
      box.innerHTML = `<div style="padding:16px;color:#666;">Ch∆∞a c√≥ ƒë∆°n n√†o.</div>`;
      return;
    }

    box.innerHTML = orders.map(o => {
      const st = o.status || "Ch·ªù duy·ªát";
      const code = o.code || ("NW-" + (o.id || ""));
      const name = o.name || "Kh√°ch";
      const phone = o.phone || "-";
      const date  = o.date || "-";
      const time  = o.time || "-";
      const people = o.people || "-";
      const note = o.note ? `<div class="order-note">Ghi ch√∫: ${o.note}</div>` : "";

      // ch·ªâ hi·ªán n√∫t thao t√°c khi c√≤n ch·ªù duy·ªát
      const actions = (st === "Ch·ªù duy·ªát")
        ? `
          <div class="order-actions">
            <button class="btn-primary" type="button" onclick="adminApprove(${o.id})">‚úî X√°c nh·∫≠n</button>
            <button class="btn-ready" type="button" onclick="adminNoShow(${o.id})">‚ö† Kh√¥ng t·ªõi</button>
            <button class="btn-danger" type="button" onclick="adminCancel(${o.id})">‚úñ H·ªßy</button>
          </div>
        `
        : `
          <div class="order-actions">
            <button class="btn-ready" type="button" disabled>${st}</button>
          </div>
        `;

      return `
        <div class="order-card-2" data-status="${st}" onclick="selectOrder('${code}')">
          <div class="order-top">
            <div class="order-id">
              <b>${code}</b>
              <span class="badge ${badgeClass(st)}">${st}</span>
            </div>
            <button class="mini-eye" type="button" title="Xem">
              <i class="fa-regular fa-eye"></i>
            </button>
          </div>

          <div class="order-meta">
            <span><i class="fa-regular fa-user"></i> ${name}</span>
            <span><i class="fa-solid fa-phone"></i> ${phone}</span>
          </div>

          <div class="order-items">
            <div class="row"><span><i class="fa-regular fa-calendar"></i> ${date}</span><b>${time}</b></div>
            <div class="row"><span><i class="fa-solid fa-users"></i> ${people} ng∆∞·ªùi</span><b></b></div>
          </div>

          ${note}

          <div class="order-bottom">
            <div class="order-total">Tr·∫°ng th√°i: <b>${st}</b></div>
            ${actions}
          </div>
        </div>
      `;
    }).join("");
  }

  // ===== ACTIONS (ADMIN) =====
  function adminApprove(id){
    const orders = getOrders();
    const x = orders.find(o => o.id == id);
    if(!x) return;
    x.status = "ƒê√£ duy·ªát";
    saveOrders(orders);
    renderAdminOrders();
  }

  function adminNoShow(id){
    const orders = getOrders();
    const x = orders.find(o => o.id == id);
    if(!x) return;
    x.status = "Kh√¥ng t·ªõi"; // ‚úÖ t√°ch ri√™ng kh·ªèi "ƒê√£ h·ªßy"
    saveOrders(orders);
    renderAdminOrders();
  }

  function adminCancel(id){
    if(!confirm("B·∫°n mu·ªën h·ªßy ƒë∆°n n√†y?")) return;
    const orders = getOrders();
    const x = orders.find(o => o.id == id);
    if(!x) return;
    x.status = "ƒê√£ h·ªßy"; // ‚úÖ KH√îNG xo√° kh·ªèi m·∫£ng ƒë·ªÉ kh√°ch v·∫´n th·∫•y l·ªãch s·ª≠
    saveOrders(orders);
    renderAdminOrders();
  }

  // ‚úÖ t·ª± c·∫≠p nh·∫≠t khi tab kh√°c (staff / pro5KH) thay ƒë·ªïi localStorage
  window.addEventListener("storage", (e) => {
    if(e.key === "orders") renderAdminOrders();
  });

  // render l·∫ßn ƒë·∫ßu khi m·ªü trang
  document.addEventListener("DOMContentLoaded", renderAdminOrders);


  
</script>

<script>
  // ===== STAFF (ADMIN) =====
  const STAFF_KEY = "staff";

  function formatVND(n){
    try {
      return Number(n || 0).toLocaleString("vi-VN") + "VND";
    } catch(e){
      return (n || 0) + "VND";
    }
  }

  function getStaff(){
    try { return JSON.parse(localStorage.getItem(STAFF_KEY) || "[]"); }
    catch(e){ return []; }
  }
  function saveStaff(arr){
    localStorage.setItem(STAFF_KEY, JSON.stringify(arr));
  }

  // Demo data n·∫øu ch∆∞a c√≥ (ƒë·ªÉ b·∫°n th·∫•y UI ch·∫°y)
  function seedStaffIfEmpty(){
    const cur = getStaff();
    if(cur.length) return;
    const demo = [
      { id: 1, code:"NV001", name: "Nguy·ªÖn VƒÉn An", role: "Qu·∫£n l√Ω", status: "ƒêang l√†m", email:"an.nguyen@nestwork.com", phone:"0987654321", startDate:"15/01/2024", salary:15000000 },
      { id: 2, code:"NV002", name: "Tr·∫ßn Th·ªã B√¨nh", role: "Pha ch·∫ø", status: "ƒêang l√†m", email:"binh.tran@nestwork.com", phone:"0912345678", startDate:"20/03/2024", salary:8000000 },
      { id: 3, code:"NV003", name: "L√™ VƒÉn C∆∞·ªùng", role: "Thu ng√¢n", status: "ƒêang l√†m", email:"cuong.le@nestwork.com", phone:"0901234567", startDate:"10/05/2024", salary:7500000 },
      { id: 4, code:"NV004", name: "Ph·∫°m Th·ªã Dung", role: "Pha ch·∫ø", status: "ƒêang l√†m", email:"dung.pham@nestwork.com", phone:"0923456789", startDate:"03/06/2024", salary:7000000 },
      { id: 5, code:"NV005", name: "Ho√†ng Minh", role: "Pha ch·∫ø", status: "ƒêang l√†m", email:"minh.hoang@nestwork.com", phone:"0934567890", startDate:"18/06/2024", salary:6500000 },
      { id: 6, code:"NV006", name: "ƒê√†o Th·ªã Lan", role: "Thu ng√¢n", status: "ƒê√£ ngh·ªâ", email:"lan.dao@nestwork.com", phone:"0945678901", startDate:"12/01/2024", salary:6500000 },
    ];
    saveStaff(demo);
  }

  function staffPillRole(role){
    const map = {
      "Qu·∫£n l√Ω": "pill-role pill-manager",
      "Pha ch·∫ø": "pill-role pill-staff",
      "Thu ng√¢n": "pill-role pill-cashier"
    };
    return map[role] || "pill-role";
  }

  function staffPillStatus(status){
    return status === "ƒê√£ ngh·ªâ" ? "pill-status pill-left" : "pill-status pill-working";
  }

  function updateStaffKPI(staff){
    const total = staff.length;
    const working = staff.filter(s => s.status === "ƒêang l√†m").length;
    const left = staff.filter(s => s.status === "ƒê√£ ngh·ªâ").length;
    const salaryTotal = staff
      .filter(s => s.status === "ƒêang l√†m")
      .reduce((sum, s) => sum + Number(s.salary || 0), 0);

    const elTotal = document.getElementById("kpiStaffTotal");
    const elWorking = document.getElementById("kpiStaffWorking");
    const elLeft = document.getElementById("kpiStaffLeft");
    const elSalary = document.getElementById("kpiStaffSalary");

    if(elTotal) elTotal.textContent = total;
    if(elWorking) elWorking.textContent = working;
    if(elLeft) elLeft.textContent = left;
    if(elSalary) elSalary.textContent = (salaryTotal/1000000).toFixed(1) + "tr";
  }

  function renderStaff(){
    const listBox = document.getElementById("staffList");
    if(!listBox) return;

    const q = (document.getElementById("staffSearch")?.value || "").trim().toLowerCase();
    const roleF = document.getElementById("staffRoleFilter")?.value || "all";
    const statusF = document.getElementById("staffStatusFilter")?.value || "all";

    const all = getStaff();

    // KPI d·ª±a tr√™n to√†n b·ªô (kh√¥ng filter)
    updateStaffKPI(all);

    const filtered = all.filter(s => {
      const hay = `${s.name||""} ${s.email||""} ${s.phone||""}`.toLowerCase();
      if(q && !hay.includes(q)) return false;
      if(roleF !== "all" && s.role !== roleF) return false;
      if(statusF !== "all" && s.status !== statusF) return false;
      return true;
    });

    if(filtered.length === 0){
      listBox.innerHTML = `<div class="card" style="padding:16px;color:#666;">Kh√¥ng c√≥ nh√¢n vi√™n ph√π h·ª£p.</div>`;
      return;
    }

    listBox.innerHTML = filtered.map(s => `
      <div class="staff-card" onclick="selectStaff(${s.id})">
        <div class="staff-avatar">${(s.name||"?").trim().charAt(0).toUpperCase()}</div>

        <div class="staff-info">
          <div class="staff-name">
            <b>${s.name || "-"}</b>
            <span class="${staffPillRole(s.role)}">${s.role || "-"}</span>
            <span class="${staffPillStatus(s.status)}">${s.status || "-"}</span>
          </div>

          <div class="staff-meta">
            <span><i class="fa-regular fa-envelope"></i> ${s.email || "-"}</span>
            <span><i class="fa-solid fa-phone"></i> ${s.phone || "-"}</span>
          </div>

          <div class="staff-meta">
            <span><i class="fa-regular fa-calendar"></i> V√†o l√†m: ${s.startDate || "-"}</span>
            <span><i class="fa-solid fa-dollar-sign"></i> ${formatVND(s.salary)}</span>
          </div>
        </div>

        <div class="staff-actions" onclick="event.stopPropagation()">
          <button class="icon-btn" title="S·ª≠a" onclick="editStaff(${s.id})"><i class="fa-regular fa-pen-to-square"></i></button>
          <button class="icon-btn danger" title="X√≥a" onclick="deleteStaff(${s.id})"><i class="fa-regular fa-trash-can"></i></button>
        </div>
      </div>
    `).join("");
  }

  function selectStaff(id){
    const s = getStaff().find(x => x.id == id);
    if(!s) return;

    document.getElementById("staffDetailEmpty").style.display = "none";
    document.getElementById("staffDetailBox").style.display = "block";

    document.getElementById("staffDetailName").textContent = s.name || "‚Äî";
    document.getElementById("staffDetailMeta").textContent = `${s.role || "‚Äî"} ‚Ä¢ ${s.status || "‚Äî"}`;

    document.getElementById("dEmail").textContent = s.email || "‚Äî";
    document.getElementById("dPhone").textContent = s.phone || "‚Äî";
    document.getElementById("dRole").textContent = s.role || "‚Äî";
    document.getElementById("dStatus").textContent = s.status || "‚Äî";
    document.getElementById("dStart").textContent = s.startDate || "‚Äî";
    document.getElementById("dSalary").textContent = formatVND(s.salary);
  }

  // T·∫°m th·ªùi: thao t√°c basic b·∫±ng prompt cho nhanh (b·∫°n mu·ªën l√†m modal ƒë·∫πp m√¨nh l√†m ti·∫øp)
  function editStaff(id){
    const staff = getStaff();
    const s = staff.find(x => x.id == id);
    if(!s) return;

    const name = prompt("T√™n nh√¢n vi√™n:", s.name || "");
    if(name === null) return;

    const role = prompt("V·ªã tr√≠ (Qu·∫£n l√Ω / Pha ch·∫ø / Thu ng√¢n):", s.role || "");
    if(role === null) return;

    const status = prompt("Tr·∫°ng th√°i (ƒêang l√†m / ƒê√£ ngh·ªâ):", s.status || "");
    if(status === null) return;

    const email = prompt("Email:", s.email || "");
    if(email === null) return;

    const phone = prompt("SƒêT:", s.phone || "");
    if(phone === null) return;

    const startDate = prompt("V√†o l√†m (dd/mm/yyyy):", s.startDate || "");
    if(startDate === null) return;

    const salary = prompt("L∆∞∆°ng / th√°ng (s·ªë):", String(s.salary || 0));
    if(salary === null) return;

    Object.assign(s, {
      name, role, status, email, phone, startDate,
      salary: Number(salary || 0)
    });

    saveStaff(staff);
    renderStaff();
    selectStaff(id);
  }

  function deleteStaff(id){
    if(!confirm("B·∫°n ch·∫Øc ch·∫Øn mu·ªën x√≥a nh√¢n vi√™n n√†y?")) return;
    let staff = getStaff().filter(x => x.id != id);
    saveStaff(staff);

    // reset detail
    document.getElementById("staffDetailBox").style.display = "none";
    document.getElementById("staffDetailEmpty").style.display = "flex";

    renderStaff();
  }

  function addStaff(){
    const staff = getStaff();
    const nextId = staff.length ? Math.max(...staff.map(s => s.id)) + 1 : 1;

    const name = prompt("T√™n nh√¢n vi√™n:");
    if(!name) return;

    const role = prompt("V·ªã tr√≠ (Qu·∫£n l√Ω / Pha ch·∫ø / Thu ng√¢n):", "Pha ch·∫ø");
    if(!role) return;

    const status = prompt("Tr·∫°ng th√°i (ƒêang l√†m / ƒê√£ ngh·ªâ):", "ƒêang l√†m");
    if(!status) return;

    const email = prompt("Email:");
    const phone = prompt("SƒêT:");
    const startDate = prompt("V√†o l√†m (dd/mm/yyyy):", "01/01/2026");
    const salary = Number(prompt("L∆∞∆°ng / th√°ng (s·ªë):", "7000000") || 0);

    staff.push({ id: nextId, name, role, status, email, phone, startDate, salary });
    saveStaff(staff);
    renderStaff();
  }

  // hook events
  document.addEventListener("DOMContentLoaded", () => {
    seedStaffIfEmpty();

    // l·ªçc / search
    document.getElementById("staffSearch")?.addEventListener("input", renderStaff);
    document.getElementById("staffRoleFilter")?.addEventListener("change", renderStaff);
    document.getElementById("staffStatusFilter")?.addEventListener("change", renderStaff);

    document.getElementById("btnAddStaff")?.addEventListener("click", addStaff);

    // render l·∫ßn ƒë·∫ßu
    renderStaff();
  });

  // c·∫≠p nh·∫≠t n·∫øu tab kh√°c ƒë·ªïi localStorage
  window.addEventListener("storage", (e) => {
    if(e.key === STAFF_KEY) renderStaff();
  });
</script>

<script>
  // ===== ACTIONS (ADMIN) =====
  function lockAndUpdateOrder(id, newStatus){
    // lu√¥n ƒë·ªçc m·ªõi nh·∫•t tr∆∞·ªõc khi c·∫≠p nh·∫≠t (tr√°nh tab kh√°c v·ª´a ƒë·ªïi)
    const orders = getOrders();
    const x = orders.find(o => o.id == id);
    if(!x) return;

    // ‚úÖ n·∫øu ƒë√£ b·ªã x·ª≠ l√Ω r·ªìi th√¨ KH√îNG cho c·∫≠p nh·∫≠t n·ªØa
    if((x.status || "Ch·ªù duy·ªát") !== "Ch·ªù duy·ªát"){
      alert(`ƒê∆°n n√†y ƒë√£ ƒë∆∞·ª£c x·ª≠ l√Ω (${x.status}). B·∫°n ch·ªâ c√≥ th·ªÉ xem tr·∫°ng th√°i.`);
      renderAdminOrders();
      return;
    }

    // ‚úÖ c·∫≠p nh·∫≠t tr·∫°ng th√°i + ghi d·∫•u ai x·ª≠ l√Ω
    x.status = newStatus;
    x.decidedBy = "admin";        // ai b·∫•m
    x.decidedAt = Date.now();     // l√∫c b·∫•m

    saveOrders(orders);
    renderAdminOrders();
  }

  function adminApprove(id){
    lockAndUpdateOrder(id, "ƒê√£ duy·ªát");
  }

  function adminNoShow(id){
    lockAndUpdateOrder(id, "Kh√¥ng t·ªõi");
  }

  function adminCancel(id){
    if(!confirm("B·∫°n mu·ªën h·ªßy ƒë∆°n n√†y?")) return;
    lockAndUpdateOrder(id, "ƒê√£ h·ªßy");
  }

</script>

<script>
/* ===== ADMIN BOOKING (D√πng chung localStorage "orders") ===== */
function getOrders(){
  try { return JSON.parse(localStorage.getItem("orders") || "[]"); }
  catch(e){ return []; }
}
function saveOrders(arr){
  localStorage.setItem("orders", JSON.stringify(arr));
}

function bookingChip(status){
  const st = status || "Ch·ªù duy·ªát";
  if(st === "ƒê√£ duy·ªát")  return `<span class="bk-chip approved">ƒê√£ duy·ªát</span>`;
  if(st === "Ch·ªù duy·ªát") return `<span class="bk-chip pending">Ch∆∞a duy·ªát</span>`;
  if(st === "Kh√¥ng t·ªõi") return `<span class="bk-chip noshow">Kh√¥ng t·ªõi</span>`;
  if(st === "ƒê√£ h·ªßy")    return `<span class="bk-chip cancel">ƒê√£ h·ªßy</span>`;
  return `<span class="bk-chip pending">${st}</span>`;
}

function toTimeBucket(timeStr){
  // timeStr d·∫°ng "15:27"
  if(!timeStr || !timeStr.includes(":")) return "all";
  const h = Number(timeStr.split(":")[0] || 0);
  if(h >= 5 && h < 11) return "morning";
  if(h >= 11 && h < 14) return "noon";
  if(h >= 14 && h < 18) return "afternoon";
  return "evening";
}

// filter date: n·∫øu order c√≥ o.createdAt (timestamp) th√¨ l·ªçc theo th·ªùi gian th·∫≠t.
// n·∫øu kh√¥ng c√≥ createdAt th√¨ coi nh∆∞ "today" ƒë·ªÉ demo kh√¥ng b·ªã r·ªóng.
function passDateFilter(o, filter){
  if(filter === "all") return true;

  const ts = Number(o.createdAt || 0);
  if(!ts) return (filter === "today"); // demo fallback

  const d = new Date(ts);
  const now = new Date();

  const startOfToday = new Date(now.getFullYear(), now.getMonth(), now.getDate()).getTime();
  const startOfWeek  = new Date(now.getFullYear(), now.getMonth(), now.getDate() - ((now.getDay()+6)%7)).getTime(); // Mon
  const startOfMonth = new Date(now.getFullYear(), now.getMonth(), 1).getTime();
  const startOfYear  = new Date(now.getFullYear(), 0, 1).getTime();

  if(filter === "today") return ts >= startOfToday;
  if(filter === "week")  return ts >= startOfWeek;
  if(filter === "month") return ts >= startOfMonth;
  if(filter === "year")  return ts >= startOfYear;
  return true;
}

function lockAndUpdateBooking(id, newStatus){
  const orders = getOrders();
  const x = orders.find(o => o.id == id);
  if(!x) return;

  const cur = x.status || "Ch·ªù duy·ªát";

  // ‚úÖ n·∫øu ƒë√£ x·ª≠ l√Ω th√¨ kh√≥a (ch·ªâ xem)
  if(cur !== "Ch·ªù duy·ªát"){
    alert(`ƒê∆°n n√†y ƒë√£ ƒë∆∞·ª£c x·ª≠ l√Ω (${cur}). B·∫°n ch·ªâ c√≥ th·ªÉ xem tr·∫°ng th√°i.`);
    renderAdminBooking();
    return;
  }

  x.status = newStatus;
  x.decidedBy = "admin";
  x.decidedAt = Date.now();

  saveOrders(orders);
  renderAdminBooking();
}

function renderAdminBooking(){
  const box = document.getElementById("bookingList");
  if(!box) return;

  const fd = document.getElementById("bkFilterDate")?.value || "today";
  const ft = document.getElementById("bkFilterTime")?.value || "all";
  const fa = document.getElementById("bkFilterArea")?.value || "all";

  const orders = getOrders();

  const filtered = orders.filter(o => {
    const st = o.status || "Ch·ªù duy·ªát";
    // booking page: m c√≥ th·ªÉ mu·ªën xem t·∫•t c·∫£ tr·∫°ng th√°i => kh√¥ng l·ªçc theo status ·ªü ƒë√¢y

    if(!passDateFilter(o, fd)) return false;

    if(ft !== "all"){
      const bucket = toTimeBucket(o.time);
      if(bucket !== ft) return false;
    }

    if(fa !== "all"){
      if((o.area || "") !== fa) return false;
    }

    return true;
  });

  if(filtered.length === 0){
    box.innerHTML = `<div class="bk-empty">Ch∆∞a c√≥ ƒë∆°n ƒë·∫∑t b√†n ph√π h·ª£p.</div>`;
    return;
  }

  box.innerHTML = filtered.map(o => {
    const st = o.status || "Ch·ªù duy·ªát";
    const locked = st !== "Ch·ªù duy·ªát";

    return `
      <div class="bk-card">
        <div class="bk-left">
          <div class="bk-title">
            ${o.name || "Kh√°ch"}
            ${bookingChip(st)}
          </div>

          <div class="bk-meta">
            <span><i class="fa-solid fa-phone"></i>${o.phone || "-"}</span>
            <span><i class="fa-solid fa-users"></i>${o.people || "-"} ng∆∞·ªùi</span>
            <span><i class="fa-regular fa-clock"></i>${o.time || "-"}</span>
            <span><i class="fa-solid fa-location-dot"></i>${o.area || "-"} ‚Ä¢ ${o.table || "-"}</span>
          </div>
        </div>

        <div class="bk-actions">
          <button class="bk-btn ok" ${locked ? "disabled" : ""} onclick="lockAndUpdateBooking(${o.id}, 'ƒê√£ duy·ªát')">
            <i class="fa-solid fa-check"></i> X√°c nh·∫≠n
          </button>

          <button class="bk-btn no" ${locked ? "disabled" : ""} onclick="lockAndUpdateBooking(${o.id}, 'Kh√¥ng t·ªõi')">
            <i class="fa-solid fa-xmark"></i> Kh√¥ng t·ªõi
          </button>

          <button class="bk-btn cancel" ${locked ? "disabled" : ""} onclick="(function(){ if(confirm('B·∫°n mu·ªën h·ªßy ƒë∆°n n√†y?')) lockAndUpdateBooking(${o.id}, 'ƒê√£ h·ªßy'); })()">
            <i class="fa-solid fa-xmark"></i> H·ªßy
          </button>
        </div>
      </div>
    `;
  }).join("");
}

document.addEventListener("DOMContentLoaded", () => {
  // hook filters
  document.getElementById("bkFilterDate")?.addEventListener("change", renderAdminBooking);
  document.getElementById("bkFilterTime")?.addEventListener("change", renderAdminBooking);
  document.getElementById("bkFilterArea")?.addEventListener("change", renderAdminBooking);

  // render l·∫ßn ƒë·∫ßu
  renderAdminBooking();
});

// sync khi tab kh√°c ƒë·ªïi localStorage
window.addEventListener("storage", (e) => {
  if(e.key === "orders") renderAdminBooking();
});



</script>

<script>
(function(){
  const KEY = "attendanceLogs";
  const tbody = document.getElementById("attTbody");
  const dateInput = document.getElementById("attDateInput");
  const searchInput = document.getElementById("attSearchInput");
  const statusFilter = document.getElementById("attStatusFilter");

  if(!tbody) return;

  const today = new Date();
  const yyyy = today.getFullYear();
  const mm = String(today.getMonth()+1).padStart(2,"0");
  const dd = String(today.getDate()).padStart(2,"0");
  if(dateInput) dateInput.value = `${yyyy}-${mm}-${dd}`;

  function getData(){
    try{
      const raw = localStorage.getItem(KEY);
      return raw ? JSON.parse(raw) : [];
    }catch(e){
      console.error("Failed to parse attendance logs:", e);
      return [];
    }
  }

  function saveData(data) {
    localStorage.setItem(KEY, JSON.stringify(data));
  }

  function chip(status){
    if(status === "ƒê√∫ng gi·ªù") return `<span class="att-chip chip-ontime"><i class="fa-solid fa-check"></i> ƒê√∫ng gi·ªù</span>`;
    if(status === "ƒêi mu·ªôn") return `<span class="att-chip chip-late"><i class="fa-solid fa-circle-exclamation"></i> ƒêi mu·ªôn</span>`;
    if(status === "V·∫Øng m·∫∑t") return `<span class="att-chip chip-absent"><i class="fa-solid fa-xmark"></i> V·∫Øng m·∫∑t</span>`;
    if(status === "V·ªÅ s·ªõm") return `<span class="att-chip chip-early"><i class="fa-solid fa-clock"></i> V·ªÅ s·ªõm</span>`;
    return `<span class="att-chip">${status||"-"}</span>`;
  }

  function calculateTotalHours(inTime, outTime) {
    if (!inTime || !outTime) return "N/A";
    try {
      const [inH, inM] = inTime.split(':').map(Number);
      const [outH, outM] = outTime.split(':').map(Number);
      const inDate = new Date(0, 0, 0, inH, inM);
      const outDate = new Date(0, 0, 0, outH, outM);
      let diff = (outDate - inDate) / (1000 * 60 * 60);
      if (diff < 0) diff += 24;
      return diff.toFixed(1) + 'h';
    } catch (e) {
      return "N/A";
    }
  }

  function formatDisplayDate(ymd) {
      if (!ymd) return "N/A";
      const [y, m, d] = ymd.split('-');
      return `${d}/${m}/${y}`;
  }

  function deleteLog(logId) {
    if (!confirm("B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a b·∫£n ghi ch·∫•m c√¥ng n√†y?")) return;
    const allLogs = getData();
    const updatedLogs = allLogs.filter(log => log.id !== logId);
    saveData(updatedLogs);
    render();
  }

  function editLog(logId) {
    const allLogs = getData();
    const logIndex = allLogs.findIndex(log => log.id === logId);
    if (logIndex === -1) {
      alert("Kh√¥ng t√¨m th·∫•y b·∫£n ghi!");
      return;
    }
    const log = allLogs[logIndex];

    const newInTime = prompt("Nh·∫≠p gi·ªù v√†o (HH:mm):", log.inTime || "");
    const newOutTime = prompt("Nh·∫≠p gi·ªù ra (HH:mm):", log.outTime || "");
    const newStatus = prompt("Nh·∫≠p tr·∫°ng th√°i (VD: ƒê√∫ng gi·ªù, ƒêi mu·ªôn, V·∫Øng m·∫∑t, V·ªÅ s·ªõm):", log.status || "");
    const newNote = prompt("Nh·∫≠p ghi ch√∫:", log.note || "");

    if (newInTime === null || newOutTime === null || newStatus === null || newNote === null) {
      return; // User cancelled
    }
    
    // Validate time format (simple HH:mm check)
    const timeRegex = /^\d{2}:\d{2}$/;
    if (!timeRegex.test(newInTime) || !timeRegex.test(newOutTime)) {
        alert("ƒê·ªãnh d·∫°ng gi·ªù kh√¥ng h·ª£p l·ªá. Vui l√≤ng nh·∫≠p theo ƒë·ªãnh d·∫°ng HH:mm.");
        return;
    }

    allLogs[logIndex] = {
      ...log,
      inTime: newInTime,
      outTime: newOutTime,
      status: newStatus,
      note: newNote
    };

    saveData(allLogs);
    render();
  }
  
  // Expose functions to the global scope so inline onclick handlers can find them
  window.deleteLog = deleteLog;
  window.editLog = editLog;

  function render(){
    const q = (searchInput.value||"").trim().toLowerCase();
    const st = statusFilter.value;
    const chosenDate = dateInput.value;

    const allLogs = getData();
    const logsForDate = allLogs.filter(r => r.date === chosenDate);

    document.getElementById("kpiTotal").textContent = logsForDate.length;
    document.getElementById("kpiOnTime").textContent = logsForDate.filter(x=>x.status==="ƒê√∫ng gi·ªù").length;
    document.getElementById("kpiLate").textContent = logsForDate.filter(x=>x.status==="ƒêi mu·ªôn").length;
    document.getElementById("kpiAbsent").textContent = logsForDate.filter(x=>x.status==="V·∫Øng m·∫∑t").length;

    const filtered = logsForDate.filter(r=>{
      const hay = `${r.staffCode || ''} ${r.staffName || ''}`.toLowerCase();
      if(q && !hay.includes(q)) return false;
      if(st !== "all" && r.status !== st) return false;
      return true;
    });

    tbody.innerHTML = filtered.map(r => {
      const totalHours = calculateTotalHours(r.inTime, r.outTime);
      const displayDate = formatDisplayDate(r.date);
      const code = r.staffCode || "N/A";
      const name = r.staffName || "N/A";
      const dept = r.dept || "Pha ch·∫ø";
      const inTime = r.inTime || "N/A";
      const outTime = r.outTime || "N/A";
      const note = r.note || "‚Äî";
      const status = r.status || "N/A";

      return `
      <tr>
        <td>${code}</td>
        <td>${name}</td>
        <td>${dept}</td>
        <td class="att-cell-muted"><i class="fa-regular fa-calendar"></i> ${displayDate}</td>
        <td class="att-cell-muted"><i class="fa-regular fa-clock"></i> ${inTime}</td>
        <td class="att-cell-muted"><i class="fa-regular fa-clock"></i> ${outTime}</td>
        <td>${totalHours}</td>
        <td>${chip(status)}</td>
        <td class="att-cell-muted">${note}</td>
        <td>
          <div class="att-actions">
            <button class="att-ico-btn edit" title="S·ª≠a" onclick="editLog('${r.id}')"><i class="fa-regular fa-pen-to-square"></i></button>
            <button class="att-ico-btn del" title="X√≥a" onclick="deleteLog('${r.id}')"><i class="fa-regular fa-trash-can"></i></button>
          </div>
        </td>
      </tr>
    `}).join("");
  }

  searchInput.addEventListener("input", render);
  dateInput.addEventListener("change", render);
  statusFilter.addEventListener("change", render);
  
  window.addEventListener("storage", (e) => {
    if (e.key === KEY) {
      render();
    }
  });

  render();
})();
</script>

<script>
document.addEventListener("DOMContentLoaded", function() {
  const adminLogoutBtn = document.getElementById("adminLogoutBtn");
  if (adminLogoutBtn) {
    adminLogoutBtn.addEventListener("click", function(event) {
      event.preventDefault(); // Prevent default link behavior if it was a link

      // Clear relevant localStorage items for logout
      localStorage.removeItem("isLogin");
      localStorage.removeItem("role");
      localStorage.removeItem("currentUser");
      localStorage.removeItem("redirectAfterLogin"); // If used for admin too

      // Redirect to index.html
      window.location.href = "index.html";
    });
  }
});
</script>

<script>
document.addEventListener("DOMContentLoaded", function() {
  const animatedItems = document.querySelectorAll("#page-dashboard .anim-on-scroll");

  if ("IntersectionObserver" in window) {
    const observer = new IntersectionObserver((entries, observer) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.classList.add("is-visible");
          observer.unobserve(entry.target); // Optional: stop observing once it's visible
        }
      });
    }, {
      threshold: 0.1 // Trigger when 10% of the item is visible
    });

    animatedItems.forEach(item => {
      observer.observe(item);
    });
  } else {
    // Fallback for older browsers
    animatedItems.forEach(item => {
      item.classList.add("is-visible");
    });
  }
});
</script>

</body>
</html>

